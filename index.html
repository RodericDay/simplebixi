<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simple Bixi</title>
</head>
<body>
  <table id=table>
    <tr>
      <th>Station</th>
      <th>Bikes</th>
      <th>Docks</th>
    </tr>
  </table>
</body>
</html>
<script>

function updatePosition(position) {
    lat = position.coords.latitude;
    long = position.coords.longitude;
    display();
}

function calculateDistance(station) {
    var dx=station.lat-lat, dy=station.long-long;
    station.distance = dx*dx + dy*dy;
}

function compare(s1, s2) {
    return s2.distance - s1.distance
}

function displayStation(station, i) {
    var row = table.insertRow(table.children.length);
    row.insertCell(0).innerHTML = station.name;
    row.insertCell(1).innerHTML = station.nbBikes;
    row.insertCell(2).innerHTML = station.nbEmptyDocks;
}

function clearTable() {
    for (var i=1; i<table.rows.length;) {
        table.deleteRow(i);
    }
}

function display(event) {
    var stations = JSON.parse(xhr.response);
    stations.forEach(calculateDistance);
    clearTable();
    stations.sort(compare).forEach(displayStation);
}

var lat = null;
var long = null;
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(updatePosition);
}

var xhr = new XMLHttpRequest();
xhr.open("GET", "https://simplebixi.herokuapp.com/");
xhr.send();
xhr.onload = display;
</script>
